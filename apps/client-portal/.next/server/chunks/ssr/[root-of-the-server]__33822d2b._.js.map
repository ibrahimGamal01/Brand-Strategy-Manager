{"version":3,"sources":["../../../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../../../apps/client-portal/src/lib/auth-api.ts","../../../../../../apps/client-portal/src/components/auth/verify-email-page-client.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","import { RuntimeWorkspace } from \"@/types/chat\";\n\nexport interface PortalUser {\n  id: string;\n  email: string;\n  fullName?: string | null;\n  companyName?: string | null;\n  emailVerified: boolean;\n  emailVerifiedAt?: string | null;\n  isAdmin: boolean;\n}\n\nexport interface PortalMeResponse {\n  user: PortalUser;\n  workspaces: RuntimeWorkspace[];\n}\n\nasync function parseJson<T>(response: Response): Promise<T> {\n  const payload = await response.json().catch(() => ({}));\n  if (!response.ok) {\n    const message =\n      typeof payload?.error === \"string\"\n        ? payload.error\n        : typeof payload?.details === \"string\"\n          ? payload.details\n          : `Request failed (${response.status})`;\n    throw new Error(message);\n  }\n  return payload as T;\n}\n\nexport async function signupPortal(input: {\n  email: string;\n  password: string;\n  fullName?: string;\n  companyName?: string;\n}) {\n  const response = await fetch(\"/api/portal/auth/signup\", {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify(input),\n  });\n  return parseJson<PortalMeResponse & { emailDelivery?: { provider: string; id?: string } }>(response);\n}\n\nexport async function loginPortal(input: { email: string; password: string }) {\n  const response = await fetch(\"/api/portal/auth/login\", {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify(input),\n  });\n  return parseJson<PortalMeResponse>(response);\n}\n\nexport async function logoutPortal() {\n  const response = await fetch(\"/api/portal/auth/logout\", {\n    method: \"POST\",\n    credentials: \"include\",\n  });\n  return parseJson<{ ok: boolean }>(response);\n}\n\nexport async function getPortalMe() {\n  const response = await fetch(\"/api/portal/auth/me\", {\n    method: \"GET\",\n    credentials: \"include\",\n    cache: \"no-store\",\n  });\n  return parseJson<PortalMeResponse>(response);\n}\n\nexport async function verifyPortalEmail(token: string) {\n  const response = await fetch(`/api/portal/auth/verify-email?token=${encodeURIComponent(token)}`, {\n    method: \"GET\",\n    credentials: \"include\",\n    cache: \"no-store\",\n  });\n  return parseJson<{ ok: boolean; userId: string }>(response);\n}\n\nexport async function resendPortalVerification() {\n  const response = await fetch(\"/api/portal/auth/resend-verification\", {\n    method: \"POST\",\n    credentials: \"include\",\n  });\n  return parseJson<{ ok: boolean; alreadyVerified?: boolean; delivery?: { provider: string; id?: string } }>(response);\n}\n","\"use client\";\n\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { verifyPortalEmail } from \"@/lib/auth-api\";\n\nexport function VerifyEmailPageClient() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const token = searchParams.get(\"token\") || \"\";\n  const [state, setState] = useState<\"loading\" | \"ok\" | \"error\">(token ? \"loading\" : \"error\");\n  const [message, setMessage] = useState(token ? \"Verifying your email...\" : \"Verification token is missing.\");\n\n  useEffect(() => {\n    let active = true;\n    if (!token) return;\n\n    verifyPortalEmail(token)\n      .then(() => {\n        if (!active) return;\n        setState(\"ok\");\n        setMessage(\"Your email has been verified successfully.\");\n      })\n      .catch((error: any) => {\n        if (!active) return;\n        const text = String(error?.message || \"Verification failed\");\n        if (text.includes(\"TOKEN_INVALID_OR_EXPIRED\")) {\n          setMessage(\"This verification link is invalid or expired.\");\n        } else {\n          setMessage(text);\n        }\n        setState(\"error\");\n      });\n\n    return () => {\n      active = false;\n    };\n  }, [token]);\n\n  return (\n    <section className=\"bat-shell grid min-h-[70vh] place-items-center py-12\">\n      <div className=\"bat-surface w-full max-w-md p-7\">\n        <h1 className=\"text-2xl font-semibold\">Verify your email</h1>\n        <p className=\"mt-3 text-sm\" style={{ color: state === \"error\" ? \"#9f2317\" : \"var(--bat-text-muted)\" }}>\n          {message}\n        </p>\n        <div className=\"mt-5 flex gap-2\">\n          {state === \"ok\" ? (\n            <button\n              type=\"button\"\n              className=\"rounded-full px-4 py-2 text-sm font-semibold\"\n              style={{ background: \"var(--bat-accent)\", color: \"white\" }}\n              onClick={() => router.push(\"/login?verified=1\")}\n            >\n              Go to login\n            </button>\n          ) : null}\n          <Link\n            href=\"/login\"\n            className=\"rounded-full border px-4 py-2 text-sm\"\n            style={{ borderColor: \"var(--bat-border)\" }}\n          >\n            Back to login\n          </Link>\n        </div>\n      </div>\n    </section>\n  );\n}\n"],"names":["module","exports","require","vendored","HooksClientContext","ServerInsertedHtml"],"mappings":"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","ignoreList":[0,1]}