{"version":3,"sources":["../../../../../../apps/client-portal/src/lib/runtime-api.ts"],"sourcesContent":["import {\n  RuntimeBranch,\n  RuntimeThread,\n  RuntimeWorkspace,\n} from \"@/types/chat\";\n\nasync function parseJson<T>(response: Response): Promise<T> {\n  const payload = await response.json().catch(() => ({}));\n  if (!response.ok) {\n    const message =\n      typeof payload?.error === \"string\"\n        ? payload.error\n        : typeof payload?.details === \"string\"\n          ? payload.details\n          : `Request failed (${response.status})`;\n    throw new Error(message);\n  }\n  return payload as T;\n}\n\nexport async function fetchWorkspaces(): Promise<RuntimeWorkspace[]> {\n  const response = await fetch(\"/api/portal/workspaces\", {\n    method: \"GET\",\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n\n  const payload = await parseJson<RuntimeWorkspace[] | { jobs?: RuntimeWorkspace[]; workspaces?: RuntimeWorkspace[] }>(response);\n  if (Array.isArray(payload)) return payload;\n  if (Array.isArray(payload?.workspaces)) return payload.workspaces;\n  if (Array.isArray(payload?.jobs)) return payload.jobs;\n  return [];\n}\n\nexport type WorkspaceIntakeFormData = {\n  name: string;\n  website: string;\n  oneSentenceDescription: string;\n  niche: string;\n  businessType: string;\n  operateWhere: string;\n  wantClientsWhere: string;\n  idealAudience: string;\n  targetAudience: string;\n  geoScope: string;\n  servicesList: string;\n  mainOffer: string;\n  primaryGoal: string;\n  secondaryGoals: string;\n  futureGoal: string;\n  engineGoal: string;\n  topProblems: string;\n  resultsIn90Days: string;\n  questionsBeforeBuying: string;\n  brandVoiceWords: string;\n  brandTone: string;\n  topicsToAvoid: string;\n  constraints: string;\n  excludedCategories: string;\n  language: string;\n  planningHorizon: string;\n  autonomyLevel: \"assist\" | \"auto\";\n  budgetSensitivity: string;\n  competitorInspirationLinks: string;\n  handles: {\n    instagram: string;\n    tiktok: string;\n    youtube: string;\n    twitter: string;\n  };\n};\n\nexport type WorkspaceIntakeStatus = {\n  workspaceId: string;\n  required: boolean;\n  completed: boolean;\n  readyForChat: boolean;\n  source: string;\n  updatedAt: string;\n  prefill: WorkspaceIntakeFormData;\n  pendingQuestionSets: Array<{\n    id: string;\n    title: string;\n    description?: string;\n    questionCount: number;\n  }>;\n};\n\nexport type IntakeSuggestedHandleValidationItem = {\n  handle: string;\n  isLikelyClient: boolean;\n  confidence: number;\n  reason: string;\n};\n\nexport type WorkspaceIntakeSuggestion = {\n  success: boolean;\n  suggested?: Record<string, unknown>;\n  suggestedHandles?: Record<string, string>;\n  suggestedHandleValidation?: {\n    instagram?: IntakeSuggestedHandleValidationItem;\n    tiktok?: IntakeSuggestedHandleValidationItem;\n  };\n  confirmationRequired?: boolean;\n  confirmationReasons?: string[];\n};\n\nexport async function fetchWorkspaceIntakeStatus(workspaceId: string) {\n  const response = await fetch(`/api/portal/workspaces/${workspaceId}/intake`, {\n    method: \"GET\",\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  return parseJson<WorkspaceIntakeStatus>(response);\n}\n\nexport async function suggestWorkspaceIntakeCompletion(\n  workspaceId: string,\n  payload: Record<string, unknown>\n) {\n  const response = await fetch(`/api/portal/workspaces/${workspaceId}/intake/suggest`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(payload),\n    credentials: \"include\",\n  });\n  return parseJson<WorkspaceIntakeSuggestion>(response);\n}\n\nexport async function submitWorkspaceIntake(\n  workspaceId: string,\n  payload: Record<string, unknown>\n) {\n  const response = await fetch(`/api/portal/workspaces/${workspaceId}/intake`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(payload),\n    credentials: \"include\",\n  });\n  return parseJson<{\n    success: boolean;\n    workspaceId: string;\n    researchJob: { id: string; status: string };\n    message: string;\n    pendingQuestionSets: WorkspaceIntakeStatus[\"pendingQuestionSets\"];\n  }>(response);\n}\n\nexport async function listRuntimeThreads(workspaceId: string): Promise<Array<RuntimeThread & { branches?: RuntimeBranch[] }>> {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/threads`, {\n    method: \"GET\",\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  const payload = await parseJson<{ threads: Array<RuntimeThread & { branches?: RuntimeBranch[] }> }>(response);\n  return Array.isArray(payload.threads) ? payload.threads : [];\n}\n\nexport async function createRuntimeThread(workspaceId: string, input: { title: string; createdBy: string }) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/threads`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(input),\n    credentials: \"include\",\n  });\n\n  return parseJson<{\n    thread: RuntimeThread & { branches?: RuntimeBranch[] };\n    mainBranch: RuntimeBranch;\n  }>(response);\n}\n\nexport async function getRuntimeThread(workspaceId: string, threadId: string) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/threads/${threadId}`, {\n    method: \"GET\",\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  return parseJson<{\n    thread: RuntimeThread;\n    branches: RuntimeBranch[];\n  }>(response);\n}\n\nexport async function createRuntimeBranch(\n  workspaceId: string,\n  threadId: string,\n  input: {\n    name: string;\n    createdBy: string;\n    forkedFromBranchId?: string;\n    forkedFromMessageId?: string;\n  }\n) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/threads/${threadId}/branches`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(input),\n    credentials: \"include\",\n  });\n  return parseJson<{ branch: RuntimeBranch }>(response);\n}\n\nexport async function pinRuntimeBranch(workspaceId: string, threadId: string, branchId: string) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/threads/${threadId}/pin-branch`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify({ branchId }),\n    credentials: \"include\",\n  });\n  return parseJson<{ thread: RuntimeThread }>(response);\n}\n\nexport type RuntimeMessageDto = {\n  id: string;\n  role: string;\n  content: string;\n  blocksJson?: unknown;\n  citationsJson?: unknown;\n  reasoningJson?: unknown;\n  createdAt: string;\n};\n\nexport async function listRuntimeMessages(workspaceId: string, branchId: string) {\n  const response = await fetch(\n    `/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/messages?limit=300`,\n    {\n      method: \"GET\",\n      cache: \"no-store\",\n      credentials: \"include\",\n    }\n  );\n  return parseJson<{ messages: RuntimeMessageDto[] }>(response);\n}\n\nexport type RuntimeEventDto = {\n  id: string;\n  type: string;\n  level: string;\n  message: string;\n  payloadJson?: unknown;\n  createdAt: string;\n  agentRunId?: string | null;\n  toolRunId?: string | null;\n};\n\nexport async function listRuntimeEvents(workspaceId: string, branchId: string) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/events?limit=150`, {\n    method: \"GET\",\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  return parseJson<{ events: RuntimeEventDto[] }>(response);\n}\n\nexport type RuntimeQueueDto = {\n  id: string;\n  content: string;\n  createdAt: string;\n  position: number;\n  status: string;\n};\n\nexport async function listRuntimeQueue(workspaceId: string, branchId: string) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/queue`, {\n    method: \"GET\",\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  return parseJson<{ queue: RuntimeQueueDto[] }>(response);\n}\n\nexport type RuntimeActiveRunDto = {\n  id: string;\n  status: string;\n  triggerType: string;\n  createdAt: string;\n  startedAt?: string | null;\n  endedAt?: string | null;\n  toolRuns: Array<{\n    id: string;\n    toolName: string;\n    status: string;\n    createdAt: string;\n    startedAt?: string | null;\n    endedAt?: string | null;\n  }>;\n};\n\nexport async function fetchRuntimeBranchState(workspaceId: string, branchId: string) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/state`, {\n    method: \"GET\",\n    cache: \"no-store\",\n    credentials: \"include\",\n  });\n  return parseJson<{\n    branch: RuntimeBranch;\n    activeRuns: RuntimeActiveRunDto[];\n  }>(response);\n}\n\nexport async function sendRuntimeMessage(\n  workspaceId: string,\n  branchId: string,\n  input: {\n    content: string;\n    userId: string;\n    mode: \"send\" | \"queue\" | \"interrupt\";\n    policy?: Record<string, unknown>;\n  }\n) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/messages`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(input),\n    credentials: \"include\",\n  });\n  return parseJson<{\n    branchId: string;\n    queued: boolean;\n    queueItemId?: string;\n    runId?: string;\n    userMessageId?: string;\n  }>(response);\n}\n\nexport async function interruptRuntimeBranch(workspaceId: string, branchId: string, reason = \"Interrupted by user\") {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/interrupt`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify({ reason }),\n    credentials: \"include\",\n  });\n  return parseJson<{ ok: boolean }>(response);\n}\n\nexport async function reorderRuntimeQueue(workspaceId: string, branchId: string, ids: string[]) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/queue/reorder`, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify({ ids }),\n    credentials: \"include\",\n  });\n  return parseJson<{ queue: RuntimeQueueDto[] }>(response);\n}\n\nexport async function cancelRuntimeQueueItem(workspaceId: string, branchId: string, itemId: string) {\n  const response = await fetch(`/api/research-jobs/${workspaceId}/runtime/branches/${branchId}/queue/${itemId}`, {\n    method: \"DELETE\",\n    credentials: \"include\",\n  });\n  return parseJson<{ queue: RuntimeQueueDto[] }>(response);\n}\n"],"names":[],"mappings":"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"}