{"version":3,"sources":["../../../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../../../apps/client-portal/src/lib/auth-api.ts","../../../../../../apps/client-portal/src/components/auth/login-page-client.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","import { RuntimeWorkspace } from \"@/types/chat\";\n\nexport interface PortalUser {\n  id: string;\n  email: string;\n  fullName?: string | null;\n  companyName?: string | null;\n  emailVerified: boolean;\n  emailVerifiedAt?: string | null;\n  isAdmin: boolean;\n}\n\nexport interface PortalMeResponse {\n  user: PortalUser;\n  workspaces: RuntimeWorkspace[];\n}\n\nasync function parseJson<T>(response: Response): Promise<T> {\n  const payload = await response.json().catch(() => ({}));\n  if (!response.ok) {\n    const message =\n      typeof payload?.error === \"string\"\n        ? payload.error\n        : typeof payload?.details === \"string\"\n          ? payload.details\n          : `Request failed (${response.status})`;\n    throw new Error(message);\n  }\n  return payload as T;\n}\n\nexport async function signupPortal(input: {\n  email: string;\n  password: string;\n  fullName?: string;\n  companyName?: string;\n}) {\n  const response = await fetch(\"/api/portal/auth/signup\", {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify(input),\n  });\n  return parseJson<PortalMeResponse & { emailDelivery?: { provider: string; id?: string } }>(response);\n}\n\nexport async function loginPortal(input: { email: string; password: string }) {\n  const response = await fetch(\"/api/portal/auth/login\", {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    credentials: \"include\",\n    body: JSON.stringify(input),\n  });\n  return parseJson<PortalMeResponse>(response);\n}\n\nexport async function logoutPortal() {\n  const response = await fetch(\"/api/portal/auth/logout\", {\n    method: \"POST\",\n    credentials: \"include\",\n  });\n  return parseJson<{ ok: boolean }>(response);\n}\n\nexport async function getPortalMe() {\n  const response = await fetch(\"/api/portal/auth/me\", {\n    method: \"GET\",\n    credentials: \"include\",\n    cache: \"no-store\",\n  });\n  return parseJson<PortalMeResponse>(response);\n}\n\nexport async function verifyPortalEmail(token: string) {\n  const response = await fetch(`/api/portal/auth/verify-email?token=${encodeURIComponent(token)}`, {\n    method: \"GET\",\n    credentials: \"include\",\n    cache: \"no-store\",\n  });\n  return parseJson<{ ok: boolean; userId: string }>(response);\n}\n\nexport async function resendPortalVerification() {\n  const response = await fetch(\"/api/portal/auth/resend-verification\", {\n    method: \"POST\",\n    credentials: \"include\",\n  });\n  return parseJson<{ ok: boolean; alreadyVerified?: boolean; delivery?: { provider: string; id?: string } }>(response);\n}\n","\"use client\";\n\nimport Link from \"next/link\";\nimport { FormEvent, useEffect, useState } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { getPortalMe, loginPortal } from \"@/lib/auth-api\";\n\nexport function LoginPageClient() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [checking, setChecking] = useState(true);\n\n  const next = searchParams.get(\"next\") || \"/app\";\n  const verified = searchParams.get(\"verified\");\n\n  useEffect(() => {\n    let active = true;\n    getPortalMe()\n      .then(() => {\n        if (!active) return;\n        router.replace(\"/app\");\n      })\n      .catch(() => undefined)\n      .finally(() => {\n        if (!active) return;\n        setChecking(false);\n      });\n    return () => {\n      active = false;\n    };\n  }, [router]);\n\n  const onSubmit = async (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setError(null);\n    setLoading(true);\n    try {\n      await loginPortal({ email, password });\n      router.push(next);\n    } catch (submitError: any) {\n      const message = String(submitError?.message || \"Login failed\");\n      if (message.includes(\"INVALID_CREDENTIALS\")) {\n        setError(\"Invalid email or password.\");\n      } else {\n        setError(message);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (checking) {\n    return (\n      <section className=\"bat-shell grid min-h-[70vh] place-items-center py-12\">\n        <div className=\"bat-surface w-full max-w-md p-7 text-sm\" style={{ color: \"var(--bat-text-muted)\" }}>\n          Checking session...\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <section className=\"bat-shell grid min-h-[70vh] place-items-center py-12\">\n      <div className=\"bat-surface w-full max-w-md p-7\">\n        <h1 className=\"text-2xl font-semibold\">Log in to BAT</h1>\n        <p className=\"mt-2 text-sm\" style={{ color: \"var(--bat-text-muted)\" }}>\n          Continue to your workspaces and live activity stream.\n        </p>\n        {verified ? (\n          <p className=\"mt-3 rounded-xl border px-3 py-2 text-sm\" style={{ borderColor: \"var(--bat-border)\", background: \"var(--bat-surface-muted)\" }}>\n            Your email is verified. You can log in now.\n          </p>\n        ) : null}\n        {error ? (\n          <p className=\"mt-3 rounded-xl border px-3 py-2 text-sm\" style={{ borderColor: \"#f4b8b4\", background: \"#fff5f4\", color: \"#9f2317\" }}>\n            {error}\n          </p>\n        ) : null}\n        <form className=\"mt-6 space-y-3\" onSubmit={onSubmit}>\n          <label className=\"block text-sm\">\n            Email\n            <input\n              className=\"mt-1 w-full rounded-xl border px-3 py-2\"\n              style={{ borderColor: \"var(--bat-border)\" }}\n              type=\"email\"\n              value={email}\n              onChange={(event) => setEmail(event.target.value)}\n              required\n              autoComplete=\"email\"\n            />\n          </label>\n          <label className=\"block text-sm\">\n            Password\n            <input\n              className=\"mt-1 w-full rounded-xl border px-3 py-2\"\n              style={{ borderColor: \"var(--bat-border)\" }}\n              type=\"password\"\n              value={password}\n              onChange={(event) => setPassword(event.target.value)}\n              required\n              autoComplete=\"current-password\"\n            />\n          </label>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full rounded-full px-4 py-2 text-sm font-semibold disabled:opacity-70\"\n            style={{ background: \"var(--bat-accent)\", color: \"white\" }}\n          >\n            {loading ? \"Logging in...\" : \"Log in\"}\n          </button>\n        </form>\n        <p className=\"mt-4 text-sm\" style={{ color: \"var(--bat-text-muted)\" }}>\n          No account? <Link href=\"/signup\">Create one</Link>\n        </p>\n      </div>\n    </section>\n  );\n}\n"],"names":["module","exports","require","vendored","HooksClientContext","ServerInsertedHtml"],"mappings":"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","ignoreList":[0,1]}