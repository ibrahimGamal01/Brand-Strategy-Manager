(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,62729,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(26160);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim();var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:i="",children:o,iconNode:c,...d},u)=>(0,a.createElement)("svg",{ref:u,...n,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:l("lucide",i),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(o)?o:[o]])),o=(e,t)=>{let s=(0,a.forwardRef)(({className:s,...n},o)=>(0,a.createElement)(i,{ref:o,iconNode:t,className:l(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...n}));return s.displayName=r(e),s},c=o("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),d=o("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),u=o("rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);function m({children:e}){return(0,t.jsx)("h3",{className:"border-b pb-2 text-sm font-semibold",style:{borderColor:"var(--bat-border)",color:"var(--bat-text)"},children:e})}function p({children:e,suggested:a=!1}){return(0,t.jsxs)("span",{className:"mb-1.5 block text-xs uppercase tracking-[0.1em]",style:{color:"var(--bat-text-muted)"},children:[e,a?(0,t.jsx)("span",{className:"ml-2 rounded-full px-2 py-0.5 text-[10px]",style:{color:"var(--bat-accent)",background:"var(--bat-accent-soft)"},children:"Suggested"}):null]})}function x(e){return(0,t.jsx)("input",{...e,className:`w-full rounded-xl border px-3 py-2 text-sm ${e.className||""}`,style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)",color:"var(--bat-text)",...e.style||{}}})}function h(e){return(0,t.jsx)("textarea",{...e,className:`w-full rounded-xl border px-3 py-2 text-sm ${e.className||""}`,style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)",color:"var(--bat-text)",...e.style||{}}})}function b({formData:e,updateField:a,suggestedFields:s}){let r=e=>s?.has(e);return(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsx)(m,{children:"Identity"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{suggested:r("name"),children:"Brand name"}),(0,t.jsx)(x,{type:"text",value:e.name,onChange:e=>a("name",e.target.value),placeholder:"e.g. Bright Growth Studio",required:!0})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{suggested:r("website"),children:"Website"}),(0,t.jsx)(x,{type:"text",value:e.website,onChange:e=>a("website",e.target.value),placeholder:"https://example.com"})]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{suggested:r("oneSentenceDescription"),children:"One-sentence business description"}),(0,t.jsx)(x,{type:"text",value:e.oneSentenceDescription,onChange:e=>a("oneSentenceDescription",e.target.value),placeholder:"What your brand does and for whom"})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Niche / industry"}),(0,t.jsx)(x,{type:"text",value:e.niche,onChange:e=>a("niche",e.target.value),placeholder:"e.g. Fitness coaching"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Business type"}),(0,t.jsx)(x,{type:"text",value:e.businessType,onChange:e=>a("businessType",e.target.value),placeholder:"Agency, SaaS, Creator, E-commerce..."})]})]}),(0,t.jsx)(m,{children:"Audience & Market"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Where you operate"}),(0,t.jsx)(x,{type:"text",value:e.operateWhere,onChange:e=>a("operateWhere",e.target.value),placeholder:"Local, regional, global..."})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Where you want more clients"}),(0,t.jsx)(x,{type:"text",value:e.wantClientsWhere,onChange:e=>a("wantClientsWhere",e.target.value),placeholder:"US, GCC, Europe..."})]})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Ideal audience (next 90 days)"}),(0,t.jsx)(x,{type:"text",value:e.idealAudience,onChange:e=>a("idealAudience",e.target.value),placeholder:"Who should BAT focus on first?"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Target audience"}),(0,t.jsx)(x,{type:"text",value:e.targetAudience,onChange:e=>a("targetAudience",e.target.value),placeholder:"Who are you trying to serve?"})]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Geo scope"}),(0,t.jsx)(x,{type:"text",value:e.geoScope,onChange:e=>a("geoScope",e.target.value),placeholder:"Global, MENA, US..."})]}),(0,t.jsx)(m,{children:"Offer & Goals"}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Services list (comma or new line)"}),(0,t.jsx)(h,{rows:3,value:e.servicesList,onChange:e=>a("servicesList",e.target.value),placeholder:"Audit, Strategy, Content operations..."})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Main offer"}),(0,t.jsx)(x,{type:"text",value:e.mainOffer,onChange:e=>a("mainOffer",e.target.value),placeholder:"Primary offer to push through content"})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Primary goal"}),(0,t.jsx)(x,{type:"text",value:e.primaryGoal,onChange:e=>a("primaryGoal",e.target.value),placeholder:"Leads, revenue, awareness..."})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Secondary goals"}),(0,t.jsx)(x,{type:"text",value:e.secondaryGoals,onChange:e=>a("secondaryGoals",e.target.value),placeholder:"Retention, engagement..."})]})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Future business goal"}),(0,t.jsx)(x,{type:"text",value:e.futureGoal,onChange:e=>a("futureGoal",e.target.value),placeholder:"Expansion goal"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Engine goal"}),(0,t.jsx)(x,{type:"text",value:e.engineGoal,onChange:e=>a("engineGoal",e.target.value),placeholder:"What BAT should optimize for"})]})]}),(0,t.jsx)(m,{children:"Problems & Outcomes"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Top problems solved"}),(0,t.jsx)(h,{rows:3,value:e.topProblems,onChange:e=>a("topProblems",e.target.value),placeholder:"3 main problems you solve"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Results expected in 90 days"}),(0,t.jsx)(h,{rows:3,value:e.resultsIn90Days,onChange:e=>a("resultsIn90Days",e.target.value),placeholder:"2 measurable outcomes"})]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Common pre-purchase questions"}),(0,t.jsx)(h,{rows:3,value:e.questionsBeforeBuying,onChange:e=>a("questionsBeforeBuying",e.target.value),placeholder:"What clients ask before buying"})]}),(0,t.jsx)(m,{children:"Voice & Constraints"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Brand voice words"}),(0,t.jsx)(x,{type:"text",value:e.brandVoiceWords,onChange:e=>a("brandVoiceWords",e.target.value),placeholder:"Calm, precise, direct..."})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Brand tone"}),(0,t.jsx)(x,{type:"text",value:e.brandTone,onChange:e=>a("brandTone",e.target.value),placeholder:"Premium, playful, formal..."})]})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Topics to avoid"}),(0,t.jsx)(x,{type:"text",value:e.topicsToAvoid,onChange:e=>a("topicsToAvoid",e.target.value),placeholder:"Unsafe promises, off-brand subjects..."})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Business constraints"}),(0,t.jsx)(x,{type:"text",value:e.constraints,onChange:e=>a("constraints",e.target.value),placeholder:"Compliance, budget, team bandwidth..."})]})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Excluded categories"}),(0,t.jsx)(x,{type:"text",value:e.excludedCategories,onChange:e=>a("excludedCategories",e.target.value),placeholder:"Coupon sites, meme pages..."})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Language"}),(0,t.jsx)(x,{type:"text",value:e.language,onChange:e=>a("language",e.target.value),placeholder:"English, Arabic..."})]})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Planning horizon"}),(0,t.jsx)(x,{type:"text",value:e.planningHorizon,onChange:e=>a("planningHorizon",e.target.value),placeholder:"90 days, 6 months..."})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Autonomy level"}),(0,t.jsxs)("select",{value:e.autonomyLevel,onChange:e=>a("autonomyLevel",e.target.value||"assist"),className:"w-full rounded-xl border px-3 py-2 text-sm",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)",color:"var(--bat-text)"},children:[(0,t.jsx)("option",{value:"assist",children:"Assist (recommended)"}),(0,t.jsx)("option",{value:"auto",children:"Auto (non-destructive)"})]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Budget sensitivity"}),(0,t.jsx)(x,{type:"text",value:e.budgetSensitivity,onChange:e=>a("budgetSensitivity",e.target.value),placeholder:"Low, medium, high"})]})]}),(0,t.jsx)(m,{children:"Competitive Inspiration"}),(0,t.jsxs)("label",{children:[(0,t.jsx)(p,{children:"Competitor/inspiration links"}),(0,t.jsx)(h,{rows:3,value:e.competitorInspirationLinks,onChange:e=>a("competitorInspirationLinks",e.target.value),placeholder:"Up to 3 links, one per line"})]})]})}let g=o("instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]),y=o("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),f=o("twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]),v=[{id:"instagram",name:"Instagram",icon:g,placeholder:"username"},{id:"tiktok",name:"TikTok",icon:y,placeholder:"username"},{id:"youtube",name:"YouTube",icon:o("youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]),placeholder:"channel"},{id:"twitter",name:"X/Twitter",icon:f,placeholder:"username"}];function j(e){return String(e||"").trim().replace(/^@+/,"").toLowerCase()}function N(e){return Object.values(e).filter(e=>j(e).length>0).length}function w({handles:e,onChange:a,suggestedPlatforms:s,suggestedHandleValidation:r}){let l=N(e);return(0,t.jsxs)("section",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.12em]",style:{color:"var(--bat-text-muted)"},children:"Active Channels"}),(0,t.jsxs)("span",{className:"bat-chip",children:[l," selected"]})]}),(0,t.jsx)("div",{className:"grid gap-3",children:v.map(l=>{let n,i=l.icon,o=String(e[l.id]||""),c=j(o).length>0,d=s?.has(l.id),u="instagram"===l.id?r?.instagram:"tiktok"===l.id?r?.tiktok:void 0,m=u&&u.isLikelyClient&&u.confidence>=.75?"suggested":"warning";return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-1.5 flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:l.name}),d?(0,t.jsx)("span",{className:"rounded-full px-2 py-0.5 text-[10px] uppercase tracking-[0.08em]",style:{background:"warning"===m?"color-mix(in srgb, var(--bat-warning) 18%, white)":"var(--bat-accent-soft)",color:"warning"===m?"var(--bat-warning)":"var(--bat-accent)"},children:"warning"===m?"Review":"Suggested"}):null]}),(0,t.jsxs)("label",{className:"relative block",children:[(0,t.jsx)("span",{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2",style:{color:c?"var(--bat-text)":"var(--bat-text-muted)"},children:(0,t.jsx)(i,{className:"h-4 w-4"})}),(0,t.jsx)("input",{type:"text",value:o,onChange:e=>a(l.id,e.target.value),className:"w-full rounded-xl border py-2.5 pl-10 pr-3 text-sm",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)",color:"var(--bat-text)"},placeholder:`@${l.placeholder}`})]}),u?.reason?(0,t.jsxs)("p",{className:"mt-1 text-xs",style:{color:"var(--bat-text-muted)"},children:[(n=Number(u.confidence||0))>=.75?"Likely your account":n>=.45?"Please confirm":"Needs review",": ",u.reason]}):null]},l.id)})}),(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--bat-text-muted)"},children:"Add at least one handle to start discovery and evidence-based recommendations."})]})}let k={name:"",website:"",oneSentenceDescription:"",niche:"",businessType:"",operateWhere:"",wantClientsWhere:"",idealAudience:"",targetAudience:"",geoScope:"",servicesList:"",mainOffer:"",primaryGoal:"",secondaryGoals:"",futureGoal:"",engineGoal:"",topProblems:"",resultsIn90Days:"",questionsBeforeBuying:"",brandVoiceWords:"",brandTone:"",topicsToAvoid:"",constraints:"",excludedCategories:"",language:"",planningHorizon:"",autonomyLevel:"assist",budgetSensitivity:"",competitorInspirationLinks:"",handles:{instagram:"",tiktok:"",youtube:"",twitter:""}};function C(e){return String(e||"").split(",").map(e=>e.trim()).filter(Boolean)}function S(e,t=10){return String(e||"").split(/[\n,]+/).map(e=>e.trim()).filter(Boolean).slice(0,t)}function A(e){return e?{...k,...e,handles:{...k.handles,...e.handles||{}}}:{...k}}function T({workspaceId:e,initialPrefill:r,onCompleted:l}){let[n,i]=(0,a.useState)(1),[o,m]=(0,a.useState)(!1),[p,x]=(0,a.useState)(""),[h,g]=(0,a.useState)(A(r)),[y,f]=(0,a.useState)(new Set),[v,k]=(0,a.useState)(new Set),[T,I]=(0,a.useState)(),[R,B]=(0,a.useState)(!1),[L,E]=(0,a.useState)([]),[M,F]=(0,a.useState)(!1);(0,a.useEffect)(()=>{g(A(r))},[r]),(0,a.useEffect)(()=>{if(3!==n)return;let e=setTimeout(()=>{l().catch(e=>{x(String(e?.message||"Failed to open chat workspace")),i(2)})},1200);return()=>clearTimeout(e)},[l,n]);let D=(0,a.useMemo)(()=>N(h.handles),[h.handles]),O=(0,a.useMemo)(()=>Object.entries(h.handles).map(([e,t])=>({platform:e,handle:function(e,t){let a=String(t||"").trim();if(!a)return"";if("instagram"===e){let e=a.match(/instagram\.com\/([a-z0-9._]{2,30})/i);if(e)return j(e[1])}if("tiktok"===e){let e=a.match(/tiktok\.com\/@?([a-z0-9._]{2,30})/i);if(e)return j(e[1])}return j(a)}(e,t)})).filter(e=>e.handle.length>0),[h.handles]),W={MISSING_PRIMARY_CHANNEL:"No confirmed primary channel was detected yet (Instagram, TikTok, YouTube, or X/Twitter).",LOW_CONFIDENCE_SUGGESTION:"One or more suggested channels have low confidence and need your confirmation.",AI_NOT_CONFIGURED:"Suggestion service is currently unavailable. You can continue manually."},G=o||0===D,z=o||0===D||R&&!M;function q(e,t){g(a=>({...a,[e]:t}))}function P(e,t){g(a=>({...a,handles:{...a.handles,[e]:t}})),R&&F(!1)}async function U(t){if(t.preventDefault(),m(!0),x(""),0===O.length){x("Add at least one social handle to continue."),m(!1);return}try{let t=await (0,s.suggestWorkspaceIntakeCompletion)(e,{...h,handles:h.handles});if(t?.success&&(t.suggested||t.suggestedHandles)){let{formData:e,suggestedKeys:a,suggestedHandlePlatforms:s}=function(e,t,a){let s=new Set,r=new Set,l={...e};for(let[e,a]of Object.entries(t||{}))e in l&&null!=a&&(Array.isArray(a)?l[e]=a.join("\n"):l[e]=String(a),s.add(e));if(a&&"object"==typeof a){let e={...l.handles};for(let[t,s]of Object.entries(a))s&&"string"==typeof s&&t in e&&(e[t]=s.trim(),r.add(t));l.handles=e}return{formData:l,suggestedKeys:s,suggestedHandlePlatforms:r}}(h,t.suggested||{},t.suggestedHandles);g(e),f(a),k(s),I(t.suggestedHandleValidation&&"object"==typeof t.suggestedHandleValidation?t.suggestedHandleValidation:void 0)}let a=t?.confirmationRequired===!0;B(a),E(Array.isArray(t?.confirmationReasons)?t.confirmationReasons:[]),F(!a),i(2)}catch(e){x(String(e?.message||"Suggestion failed")),B(!1),E([]),F(!0),i(2)}finally{m(!1)}}async function $(){if(m(!0),x(""),0===O.length){x("At least one social handle is required."),m(!1);return}if(R&&!M){x("Please confirm the suggested channels before starting."),m(!1);return}try{let t,a,r=(t=C(h.secondaryGoals),a=C(h.excludedCategories),{...h,servicesList:S(h.servicesList,20),topProblems:S(h.topProblems,3),resultsIn90Days:S(h.resultsIn90Days,2),questionsBeforeBuying:S(h.questionsBeforeBuying,3),competitorInspirationLinks:S(h.competitorInspirationLinks,3),secondaryGoals:t,excludedCategories:a,channels:O,handle:O[0]?.handle,platform:O[0]?.platform,surfaces:O.map(e=>e.platform),constraints:{operatorGoal:h.engineGoal,businessConstraints:h.constraints,excludedCategories:a,autonomyLevel:h.autonomyLevel,budgetSensitivity:h.budgetSensitivity,brandTone:h.brandTone,brandVoiceWords:h.brandVoiceWords,topicsToAvoid:S(h.topicsToAvoid,15),language:h.language,planningHorizon:h.planningHorizon}}),l=await (0,s.submitWorkspaceIntake)(e,r);if(!l?.success)throw Error("Failed to start smart workflow");i(3)}catch(e){x(String(e?.message||"Failed to submit intake"))}finally{m(!1)}}return(0,t.jsx)("section",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"bat-surface p-6",children:[(0,t.jsxs)("div",{className:"mb-5 flex flex-wrap items-start justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.12em]",style:{color:"var(--bat-text-muted)"},children:"Workspace Setup"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Initialize BAT Brain"}),(0,t.jsx)("p",{className:"mt-1 text-sm",style:{color:"var(--bat-text-muted)"},children:"Complete this intro once so BAT can run smart discovery and tailored planning."})]}),(0,t.jsxs)("span",{className:"bat-chip",children:["Step ",n," of 3"]})]}),1===n?(0,t.jsxs)("form",{className:"space-y-5",onSubmit:U,children:[(0,t.jsx)(b,{formData:h,updateField:q}),(0,t.jsx)(w,{handles:h.handles,onChange:P}),p?(0,t.jsx)("div",{className:"rounded-xl border px-3 py-2 text-sm",style:{borderColor:"#f4b8b4",background:"#fff5f4",color:"#9f2317"},children:p}):null,(0,t.jsxs)("button",{type:"submit",disabled:G,className:"inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium disabled:opacity-60",style:{background:"var(--bat-accent)",color:"white"},children:[(0,t.jsx)(u,{className:"h-4 w-4"}),o?"Checking suggestions...":`Continue (${D} channel${1===D?"":"s"})`]})]}):null,2===n?(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsx)("div",{className:"rounded-xl border px-4 py-3 text-sm",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface-muted)",color:"var(--bat-text-muted)"},children:"Review and edit your setup, then start smart workflow."}),(0,t.jsx)(b,{formData:h,updateField:q,suggestedFields:y}),(0,t.jsx)(w,{handles:h.handles,onChange:P,suggestedPlatforms:v,suggestedHandleValidation:T}),R?(0,t.jsxs)("div",{className:"rounded-xl border px-4 py-3",style:{borderColor:"color-mix(in srgb, var(--bat-warning) 45%, var(--bat-border))",background:"color-mix(in srgb, var(--bat-warning) 12%, white)"},children:[(0,t.jsxs)("p",{className:"mb-2 inline-flex items-center gap-2 text-sm font-semibold",style:{color:"var(--bat-warning)"},children:[(0,t.jsx)(c,{className:"h-4 w-4"}),"Confirmation required"]}),(0,t.jsx)("div",{className:"space-y-1 text-xs",style:{color:"var(--bat-text-muted)"},children:L.map(e=>(0,t.jsxs)("p",{children:["• ",W[e]||e]},e))}),(0,t.jsxs)("label",{className:"mt-3 inline-flex items-start gap-2 text-xs",style:{color:"var(--bat-text)"},children:[(0,t.jsx)("input",{type:"checkbox",checked:M,onChange:e=>F(e.target.checked),className:"mt-0.5"}),"I confirm these channels are correct and should be used to start BAT."]})]}):null,p?(0,t.jsx)("div",{className:"rounded-xl border px-3 py-2 text-sm",style:{borderColor:"#f4b8b4",background:"#fff5f4",color:"#9f2317"},children:p}):null,(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>i(1),className:"rounded-full border px-4 py-2 text-sm",style:{borderColor:"var(--bat-border)"},children:"Back"}),(0,t.jsxs)("button",{type:"button",onClick:$,disabled:z,className:"inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium disabled:opacity-60",style:{background:"var(--bat-accent)",color:"white"},children:[(0,t.jsx)(u,{className:"h-4 w-4"}),o?"Starting...":"Confirm and start BAT"]})]})]}):null,3===n?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-2xl",style:{background:"var(--bat-accent-soft)",color:"var(--bat-accent)"},children:(0,t.jsx)(d,{className:"h-6 w-6"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Starting smart workflow"}),(0,t.jsxs)("p",{className:"text-sm",style:{color:"var(--bat-text-muted)"},children:["Discovery is running for ",Object.values(h.handles).map(e=>j(e)).filter(Boolean).map(e=>`@${e}`).join(", "),". Opening your chat workspace..."]})]}):null]})})}let I=o("layout-panel-left",[["rect",{width:"7",height:"18",x:"3",y:"3",rx:"1",key:"2obqm"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}]]),R=o("layout-panel-top",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}]]),B=o("panel-left-open",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);var L=e.i(18566);let E={tone:"balanced",sourceFocus:"mixed",transparency:!0,askQuestionsFirst:!1};function M(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function F(e){return String(e||"").trim()||new Date().toISOString()}function D(e,t=12){return Array.isArray(e)?e.map(e=>String(e||"").trim()).filter(Boolean).slice(0,t):[]}function O(e){let t=new Date(e);return Number.isNaN(t.getTime())?"Now":t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}let W=o("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),G=o("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),z=o("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),q=o("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),P=o("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),U=["Go deeper","Show sources","Make it a PDF","Focus on TikTok","Focus on Web evidence","Be concise","Ask me questions first"];function $({isStreaming:e,queuedMessages:s,onSend:r,onStop:l,onReorderQueue:n,onDeleteQueued:i,onSteer:o}){let[c,d]=(0,a.useState)("");return(0,t.jsxs)("section",{className:"bat-surface p-4",children:[(0,t.jsxs)("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Steer BAT"}),(0,t.jsxs)("span",{className:"bat-chip",children:["Queued: ",s.length]})]}),(0,t.jsx)("div",{className:"mb-3 flex flex-wrap gap-2",children:U.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>o(e),className:"rounded-full border px-3 py-1.5 text-xs",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface-muted)"},children:e},e))}),s.length>0?(0,t.jsxs)("div",{className:"mb-3 rounded-xl border p-3",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface-muted)"},children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.08em]",style:{color:"var(--bat-text-muted)"},children:"Message Queue"}),(0,t.jsx)("div",{className:"mt-2 space-y-2",children:s.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-xl border p-2",style:{borderColor:"var(--bat-border)"},children:[(0,t.jsx)("p",{className:"flex-1 text-sm",children:e.content}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{type:"button","aria-label":"Move up",onClick:()=>n(a,a-1),className:"rounded-full border p-1",style:{borderColor:"var(--bat-border)"},children:(0,t.jsx)(z,{className:"h-3 w-3"})}),(0,t.jsx)("button",{type:"button","aria-label":"Move down",onClick:()=>n(a,a+1),className:"rounded-full border p-1",style:{borderColor:"var(--bat-border)"},children:(0,t.jsx)(q,{className:"h-3 w-3"})}),(0,t.jsx)("button",{type:"button","aria-label":"Remove",onClick:()=>i(e.id),className:"rounded-full border p-1",style:{borderColor:"var(--bat-border)"},children:(0,t.jsx)(P,{className:"h-3 w-3"})})]})]},e.id))})]}):null,(0,t.jsxs)("form",{onSubmit:t=>{t.preventDefault();let a=c.trim();if(a){if(e){r(a,window.confirm("BAT is currently running. Press OK to interrupt and send now, or Cancel to queue this message.")?"send":"queue"),d("");return}r(a,"send"),d("")}},className:"flex gap-2",children:[(0,t.jsx)("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:"Ask BAT to run analysis, generate a brief, or adjust strategy...",className:"min-h-[84px] flex-1 rounded-2xl border px-3 py-2 text-sm outline-none",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)"}}),(0,t.jsxs)("div",{className:"flex w-28 flex-col gap-2",children:[(0,t.jsxs)("button",{type:"submit",className:"inline-flex items-center justify-center gap-1 rounded-full px-3 py-2 text-sm font-semibold",style:{background:"var(--bat-accent)",color:"white"},children:[e?(0,t.jsx)(y,{className:"h-4 w-4"}):(0,t.jsx)(W,{className:"h-4 w-4"}),e?"Send":"Run"]}),e?(0,t.jsxs)("button",{type:"button",onClick:l,className:"inline-flex items-center justify-center gap-1 rounded-full border px-3 py-2 text-sm",style:{borderColor:"var(--bat-border)"},children:[(0,t.jsx)(G,{className:"h-4 w-4"})," Stop"]}):null]})]})]})}let _=o("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),H=o("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);function Q({message:e}){let[s,r]=(0,a.useState)(!1);return e.reasoning?(0,t.jsxs)("div",{className:"mt-3 rounded-xl border p-3",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface-muted)"},children:[(0,t.jsxs)("button",{type:"button",className:"flex w-full items-center justify-between text-sm font-semibold",onClick:()=>r(e=>!e),children:["How BAT got here",s?(0,t.jsx)(H,{className:"h-4 w-4"}):(0,t.jsx)(_,{className:"h-4 w-4"})]}),s?(0,t.jsxs)("div",{className:"mt-3 space-y-3 text-sm",style:{color:"var(--bat-text-muted)"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",style:{color:"var(--bat-text)"},children:"Plan"}),(0,t.jsx)("ul",{className:"mt-1 list-disc pl-5",children:e.reasoning.plan.map(e=>(0,t.jsx)("li",{children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",style:{color:"var(--bat-text)"},children:"Tools used"}),(0,t.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:e.reasoning.tools.map(e=>(0,t.jsx)("span",{className:"bat-chip",children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",style:{color:"var(--bat-text)"},children:"Assumptions"}),(0,t.jsx)("ul",{className:"mt-1 list-disc pl-5",children:e.reasoning.assumptions.map(e=>(0,t.jsx)("li",{children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",style:{color:"var(--bat-text)"},children:"Next steps"}),(0,t.jsx)("ul",{className:"mt-1 list-disc pl-5",children:e.reasoning.nextSteps.map(e=>(0,t.jsx)("li",{children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",style:{color:"var(--bat-text)"},children:"Evidence"}),(0,t.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:e.reasoning.evidence.map(e=>e.href?(0,t.jsx)("a",{href:e.href,target:"_blank",rel:"noreferrer",className:"bat-chip hover:opacity-80",children:e.label},e.id):(0,t.jsx)("span",{className:"bat-chip",children:e.label},e.id))})]})]}):null]}):null}function V({messages:e,onForkFromMessage:a}){return e.length?(0,t.jsx)("section",{className:"bat-surface flex min-h-[55vh] flex-col gap-4 p-4 md:p-5",children:e.map(e=>(0,t.jsxs)("article",{className:"max-w-[92%] rounded-2xl border px-4 py-3",style:{borderColor:"user"===e.role?"transparent":"var(--bat-border)",marginLeft:"user"===e.role?"auto":0,background:"user"===e.role?"var(--bat-accent-soft)":"var(--bat-surface)"},children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.12em]",style:{color:"var(--bat-text-muted)"},children:e.role}),a?(0,t.jsx)("button",{type:"button",onClick:()=>a(e.id),className:"rounded-full border px-2 py-1 text-[11px]",style:{borderColor:"var(--bat-border)"},children:"Fork from here"}):null]}),(0,t.jsx)("p",{className:"whitespace-pre-wrap text-sm md:text-[15px]",children:e.content}),"assistant"===e.role?(0,t.jsx)(Q,{message:e}):null]},e.id))}):(0,t.jsx)("section",{className:"bat-surface flex min-h-[55vh] items-center justify-center p-6 text-center",children:(0,t.jsx)("p",{className:"max-w-md text-sm",style:{color:"var(--bat-text-muted)"},children:"Start by asking BAT for an analysis, a 30-day plan, or a competitor audit. Results and approvals will appear here in one thread."})})}let K=o("command",[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]]),Y=o("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),J=["Run competitor discovery","Generate PDF deliverable","Open library: Web","Open library: Competitors","Add constraint","Switch workspace"];function X({onSelect:e}){let[s,r]=(0,a.useState)(!1),[l,n]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"k"===e.key.toLowerCase()&&(e.preventDefault(),r(e=>!e)),"Escape"===e.key&&r(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let i=(0,a.useMemo)(()=>{let e=l.trim().toLowerCase();return J.filter(t=>!e||t.toLowerCase().includes(e))},[l]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",onClick:()=>r(!0),className:"rounded-full border px-3 py-1.5 text-sm",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)"},children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)(K,{className:"h-4 w-4"})," Command"]})}),s?(0,t.jsx)("div",{className:"fixed inset-0 z-50 grid place-items-start bg-black/30 pt-[15vh]",children:(0,t.jsxs)("div",{className:"w-full max-w-xl rounded-2xl border p-3",style:{background:"var(--bat-surface)",borderColor:"var(--bat-border)"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-xl border px-3 py-2",style:{borderColor:"var(--bat-border)"},children:[(0,t.jsx)(Y,{className:"h-4 w-4"}),(0,t.jsx)("input",{value:l,onChange:e=>n(e.target.value),placeholder:"Search commands",className:"w-full bg-transparent outline-none"}),(0,t.jsx)("button",{type:"button",onClick:()=>r(!1),children:(0,t.jsx)(P,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"mt-2 space-y-1",children:i.map(a=>(0,t.jsx)("button",{type:"button",onClick:()=>{e(a),r(!1)},className:"block w-full rounded-xl px-3 py-2 text-left text-sm hover:bg-black/5",children:a},a))})]})}):null]})}let Z=o("clock-3",[["path",{d:"M12 6v6h4",key:"135r8i"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ee=o("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),et=o("circle-pause",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]),ea=o("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function es({status:e}){return"running"===e?(0,t.jsx)(ee,{className:"h-4 w-4 animate-spin",style:{color:"var(--bat-accent)"}}):"waiting_input"===e?(0,t.jsx)(et,{className:"h-4 w-4",style:{color:"var(--bat-warning)"}}):"done"===e?(0,t.jsx)(d,{className:"h-4 w-4",style:{color:"var(--bat-success)"}}):"failed"===e?(0,t.jsx)(ea,{className:"h-4 w-4",style:{color:"#b3261e"}}):(0,t.jsx)(Z,{className:"h-4 w-4",style:{color:"var(--bat-text-muted)"}})}function er({runs:e}){return(0,t.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,t.jsxs)("article",{className:"rounded-xl border p-3",style:{borderColor:"var(--bat-border)"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:e.label}),(0,t.jsx)(es,{status:e.status})]}),(0,t.jsx)("p",{className:"mt-1 text-xs",style:{color:"var(--bat-text-muted)"},children:e.stage}),(0,t.jsx)("div",{className:"mt-2 h-2 rounded-full",style:{background:"var(--bat-surface-muted)"},children:(0,t.jsx)("div",{className:"h-2 rounded-full transition-all",style:{width:`${Math.max(0,Math.min(100,e.progress))}%`,background:"var(--bat-accent)"}})}),(0,t.jsxs)("p",{className:"mt-1 text-xs",style:{color:"var(--bat-text-muted)"},children:[e.progress,"%"]})]},e.id))})}function el({feedItems:e}){return(0,t.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,t.jsxs)("article",{className:"rounded-xl border p-3",style:{borderColor:"var(--bat-border)"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.08em]",style:{color:"var(--bat-text-muted)"},children:e.timestamp}),e.actionLabel?(0,t.jsx)("button",{type:"button",className:"rounded-full border px-2 py-1 text-xs",style:{borderColor:"var(--bat-border)"},children:e.actionLabel}):null]}),(0,t.jsx)("p",{className:"mt-1 text-sm",children:e.message})]},e.id))})}function en({decisions:e,onResolve:a}){return e.length?(0,t.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,t.jsxs)("article",{className:"rounded-xl border p-3",style:{borderColor:"var(--bat-border)"},children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:e.prompt}),(0,t.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:e.options.map(s=>(0,t.jsx)("button",{type:"button",onClick:()=>a(e.id,s),className:"rounded-full border px-3 py-1.5 text-xs",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface-muted)"},children:s},s))})]},e.id))}):(0,t.jsx)("div",{className:"rounded-xl border p-3 text-sm",style:{borderColor:"var(--bat-border)",color:"var(--bat-text-muted)"},children:"No pending approvals right now."})}function ei({runs:e,feedItems:s,decisions:r,onResolve:l}){let[n,i]=(0,a.useState)("running"),o=(0,a.useMemo)(()=>[{id:"running",label:"Now Running"},{id:"feed",label:"Activity Feed"},{id:"decisions",label:"Approvals"}],[]);return(0,t.jsxs)("aside",{className:"bat-surface h-full p-4",children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-base font-semibold",children:"Live Activity"}),(0,t.jsx)("span",{className:"bat-chip",children:"Client Friendly View"})]}),(0,t.jsx)("div",{className:"mb-4 grid grid-cols-3 gap-1 rounded-full p-1",style:{background:"var(--bat-surface-muted)"},children:o.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>i(e.id),className:"rounded-full px-2 py-1 text-xs",style:{background:n===e.id?"var(--bat-surface)":"transparent",border:n===e.id?"1px solid var(--bat-border)":"1px solid transparent"},children:e.label},e.id))}),(0,t.jsxs)("div",{className:"max-h-[62vh] overflow-y-auto pr-1",children:["running"===n?(0,t.jsx)(er,{runs:e}):null,"feed"===n?(0,t.jsx)(el,{feedItems:s}):null,"decisions"===n?(0,t.jsx)(en,{decisions:r,onResolve:l}):null]})]})}let eo=[{id:"all",label:"All"},{id:"web",label:"Web"},{id:"competitors",label:"Competitors"},{id:"social",label:"Social"},{id:"community",label:"Community"},{id:"news",label:"News"},{id:"deliverables",label:"Deliverables"}];function ec({open:e,onClose:s,items:r,activeCollection:l,onCollectionChange:n,onUseInChat:i}){let[o,c]=(0,a.useState)(""),d=(0,a.useMemo)(()=>r.filter(e=>{let t="all"===l||e.collection===l,a=o.trim().toLowerCase(),s=!a||e.title.toLowerCase().includes(a)||e.summary.toLowerCase().includes(a)||e.tags.join(" ").toLowerCase().includes(a);return t&&s}),[l,r,o]);return e?(0,t.jsxs)("div",{className:"fixed inset-0 z-40 flex",children:[(0,t.jsx)("button",{type:"button","aria-label":"close drawer",className:"h-full flex-1 bg-black/25",onClick:s}),(0,t.jsxs)("aside",{className:"h-full w-full max-w-md border-l p-4",style:{background:"var(--bat-surface)",borderColor:"var(--bat-border)"},children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Library"}),(0,t.jsx)("button",{type:"button",onClick:s,className:"rounded-full border p-2",style:{borderColor:"var(--bat-border)"},children:(0,t.jsx)(P,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"rounded-xl border px-3 py-2",style:{borderColor:"var(--bat-border)"},children:(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",style:{color:"var(--bat-text-muted)"},children:[(0,t.jsx)(Y,{className:"h-4 w-4"}),(0,t.jsx)("input",{value:o,onChange:e=>c(e.target.value),placeholder:"Search evidence",className:"w-full border-none bg-transparent outline-none"})]})}),(0,t.jsx)("div",{className:"my-3 flex flex-wrap gap-2",children:eo.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>n(e.id),className:"rounded-full border px-3 py-1.5 text-xs",style:{borderColor:"var(--bat-border)",background:l===e.id?"var(--bat-accent-soft)":"var(--bat-surface-muted)"},children:e.label},e.id))}),(0,t.jsx)("div",{className:"space-y-2 overflow-y-auto pb-4",style:{maxHeight:"calc(100vh - 220px)"},children:d.map(e=>(0,t.jsxs)("article",{className:"rounded-xl border p-3",style:{borderColor:"var(--bat-border)"},children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:e.title}),(0,t.jsx)("p",{className:"mt-1 text-xs",style:{color:"var(--bat-text-muted)"},children:e.summary}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:e.tags.map(e=>(0,t.jsx)("span",{className:"bat-chip",children:e},e))}),(0,t.jsxs)("p",{className:"mt-2 text-xs",style:{color:"var(--bat-text-muted)"},children:[e.freshness," • ",e.evidenceLabel]}),(0,t.jsx)("button",{type:"button",onClick:()=>i(e),className:"mt-2 rounded-full border px-3 py-1 text-xs",style:{borderColor:"var(--bat-border)"},children:"Use in answer"})]},e.id))})]})]}):null}let ed={"Go deeper":{pref:["tone","balanced"],prompt:"Go deeper with the current strategy and include lane-by-lane recommendations."},"Show sources":{pref:["transparency",!0],prompt:"Show every claim with source evidence and confidence level."},"Make it a PDF":{prompt:"Generate a client-ready PDF deliverable from this branch."},"Focus on TikTok":{pref:["sourceFocus","social"],prompt:"Prioritize TikTok and social evidence in the next response."},"Focus on Web evidence":{pref:["sourceFocus","web"],prompt:"Prioritize web evidence and cite pages directly."},"Be concise":{pref:["tone","concise"]},"Ask me questions first":{pref:["askQuestionsFirst",!0]}};function eu({workspaceId:e}){let[r,l]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),[o,c]=(0,a.useState)("all"),[d,u]=(0,a.useState)(null),m=(0,L.useRouter)(),{loading:p,syncing:x,error:h,threads:b,activeThreadId:g,activeBranchId:y,branches:f,messages:v,processRuns:j,feedItems:N,decisions:w,queuedMessages:k,isStreaming:C,libraryItems:S,preferences:A,setActiveThreadId:T,createThread:W,createBranch:G,pinBranch:z,sendMessage:q,interruptRun:P,reorderQueue:U,removeQueued:_,resolveDecision:H,setPreference:Q,refreshNow:K}=function(e){let[t,r]=(0,a.useState)(!0),[l,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(null),[c,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(null),[p,x]=(0,a.useState)(null),[h,b]=(0,a.useState)([]),[g,y]=(0,a.useState)([]),[f,v]=(0,a.useState)([]),[j,N]=(0,a.useState)([]),[w,k]=(0,a.useState)([]),[C,S]=(0,a.useState)(E),A=(0,a.useRef)(null),T=(0,a.useMemo)(()=>c.find(e=>e.id===u)||null,[u,c]),I=(0,a.useMemo)(()=>T?.branches||[],[T]),R=(0,a.useCallback)(e=>{m(e);let t=c.find(t=>t.id===e);t&&x(t.pinnedBranchId||t.branches?.[0]?.id||null)},[c]),B=(0,a.useCallback)(e=>{x(e)},[]),L=(0,a.useCallback)(async t=>{n(!0);try{let[a,r,l,n,i]=await Promise.all([(0,s.listRuntimeThreads)(e),(0,s.listRuntimeMessages)(e,t),(0,s.listRuntimeEvents)(e,t),(0,s.listRuntimeQueue)(e,t),(0,s.fetchRuntimeBranchState)(e,t)]);d(a),m(e=>{if(e&&a.some(t=>t.id===e))return e;let s=a.find(e=>e.branches?.some(e=>e.id===t))||a[0]||null;return s?.id||null});let c=r.messages.filter(e=>"TOOL"!==String(e.role||"").toUpperCase()).map(e=>{let t,a=M(e.reasoningJson)?e.reasoningJson:null,s=(a&&Array.isArray(a.evidence)?a.evidence:[]).map(e=>{if(!M(e))return null;let t=String(e.id||"").trim(),a=String(e.label||"").trim();return t&&a?{id:t,label:a,..."string"==typeof e.url?{href:e.url}:{}}:null}).filter(e=>!!e);return{id:String(e.id||""),role:(t=String(e.role||"SYSTEM").trim().toUpperCase(),"USER"===t?"user":"ASSISTANT"===t?"assistant":"system"),content:String(e.content||""),createdAt:F(e.createdAt),...a?{reasoning:{plan:D(a.plan),tools:D(a.tools),assumptions:D(a.assumptions),nextSteps:D(a.nextSteps),evidence:s}}:{}}}),u=l.events,p=i.activeRuns||[];b(c),v([...u].slice(-60).reverse().map(e=>{let t=String(e.type||"").toUpperCase(),a="PROCESS_RESULT"===t?"Open result":"DECISION_REQUIRED"===t?"Review options":void 0;return{id:String(e.id||`${e.createdAt||Math.random()}`),timestamp:O(F(e.createdAt)),message:String(e.message||""),...a?{actionLabel:a}:{}}})),N(function(e,t){let a=[],s=new Set(t.filter(e=>"WAITING_USER"===String(e.status||"").toUpperCase()).map(e=>String(e.id||"").trim()).filter(Boolean));if(0===s.size)return[];for(let t of[...e].slice(-160)){let e=String(t.agentRunId||"").trim();if(!e||!s.has(e))continue;let r=M(t.payloadJson)?t.payloadJson:null;if(r&&Array.isArray(r.decisions))for(let e of r.decisions){if(!M(e))continue;let t=String(e.id||"").trim(),s=String(e.title||"").trim();if(!t||!s)continue;let r=Array.isArray(e.options)?e.options.map(e=>"string"==typeof e?e.trim():M(e)?String(e.label||e.value||"").trim():"").filter(Boolean):[];r.length&&(a.some(e=>e.id===t)||a.push({id:t,prompt:s,options:r}))}}return a}(u,p)),y(p.map(e=>{let t=String(e.status||"RUNNING").toUpperCase(),a=Array.isArray(e.toolRuns)?e.toolRuns:[],s=a.length||1,r=a.filter(e=>M(e)&&"DONE"===String(e.status||"").toUpperCase()).length,l="DONE"===t?100:Math.min(95,Math.round(r/s*100)),n="WAITING_USER"===t?"Waiting for approval":"WAITING_TOOLS"===t?`Running ${a.length||1} task(s)`:"QUEUED"===t?"Queued":"FAILED"===t?"Failed":"CANCELLED"===t?"Cancelled":"DONE"===t?"Completed":"Running";return{id:String(e.id||""),label:`Run ${String(e.triggerType||"workflow").toLowerCase().replace(/_/g," ")}`,stage:n,progress:l,status:"WAITING_USER"===t?"waiting_input":"DONE"===t?"done":"FAILED"===t?"failed":"CANCELLED"===t?"cancelled":"running"}})),k((n.queue||[]).map(e=>({id:String(e.id),content:String(e.content),createdAt:F(e.createdAt)}))),o(null)}catch(e){o(String(e?.message||"Failed to sync runtime data"))}finally{n(!1)}},[e]),W=(0,a.useCallback)(async()=>{let t=await (0,s.listRuntimeThreads)(e);if(!t.length){let a=await (0,s.createRuntimeThread)(e,{title:"Main workspace thread",createdBy:"portal-user"});t=[{...a.thread,branches:a.thread.branches||[a.mainBranch]}]}d(t);let a=t[0],r=a?.id||null,l=a?.pinnedBranchId||a?.branches?.[0]?.id||null;m(r),x(l)},[e]),G=(0,a.useCallback)(async()=>{p&&await L(p)},[p,L]),z=(0,a.useCallback)(async(t,a)=>{if(!p)return;let r=t.trim();if(!r)return;let l="queue"===a?"queue":g.some(e=>"running"===e.status)?"interrupt":"send";await (0,s.sendRuntimeMessage)(e,p,{content:r,userId:"portal-user",mode:l,policy:{autoContinue:!C.askQuestionsFirst,maxAutoContinuations:+("concise"!==C.tone),maxToolRuns:"concise"===C.tone?2:4,toolConcurrency:"mixed"===C.sourceFocus?3:2,allowMutationTools:!1,maxToolMs:3e4,sourceFocus:C.sourceFocus,transparency:C.transparency}}),await L(p)},[p,C,g,L,e]),q=(0,a.useCallback)(async()=>{p&&(await (0,s.interruptRuntimeBranch)(e,p,"Interrupted by user"),await L(p))},[p,L,e]),P=(0,a.useCallback)(async(t,a)=>{if(!p||t<0||a<0||t>=w.length||a>=w.length)return;let r=[...w],[l]=r.splice(t,1);r.splice(a,0,l),await (0,s.reorderRuntimeQueue)(e,p,r.map(e=>e.id)),await L(p)},[p,w,L,e]),U=(0,a.useCallback)(async t=>{p&&(await (0,s.cancelRuntimeQueueItem)(e,p,t),await L(p))},[p,L,e]),$=(0,a.useCallback)(async(e,t)=>{await z(`Decision ${e}: ${t}`,"send")},[z]),_=(0,a.useCallback)(async t=>{let a=await (0,s.createRuntimeThread)(e,{title:t.trim()||"New thread",createdBy:"portal-user"});m(a.thread.id),x(a.mainBranch.id),await L(a.mainBranch.id)},[L,e]),H=(0,a.useCallback)(async(t,a)=>{if(!u||!p)return;let r={name:t.trim()||`Branch ${new Date().toLocaleTimeString()}`,createdBy:"portal-user",forkedFromBranchId:p,...a?{forkedFromMessageId:a}:{}},l=await (0,s.createRuntimeBranch)(e,u,r);await (0,s.pinRuntimeBranch)(e,u,l.branch.id),x(l.branch.id),await L(l.branch.id)},[p,u,L,e]),Q=(0,a.useCallback)(async t=>{let a=u||c.find(e=>e.branches?.some(e=>e.id===t))?.id||null;a&&(await (0,s.pinRuntimeBranch)(e,a,t),m(a),x(t),await L(t))},[u,L,c,e]),V=(0,a.useCallback)((e,t)=>{S(a=>({...a,[e]:t}))},[]);return(0,a.useEffect)(()=>{let e=!0;return r(!0),o(null),W().catch(t=>{e&&o(String(t?.message||"Failed to initialize runtime workspace"))}).finally(()=>{e&&r(!1)}),()=>{e=!1}},[W,e]),(0,a.useEffect)(()=>{if(p)return L(p),A.current&&(clearInterval(A.current),A.current=null),A.current=setInterval(()=>{L(p)},2200),()=>{A.current&&(clearInterval(A.current),A.current=null)}},[p,L]),(0,a.useEffect)(()=>{if(!u)return;let e=c.find(e=>e.id===u);!e||e.branches?.some(e=>e.id===p)||x(e.pinnedBranchId||e.branches?.[0]?.id||null)},[p,u,c]),{loading:t,syncing:l,error:i,threads:c,activeThreadId:u,activeBranchId:p,branches:I,messages:h,processRuns:g,feedItems:f,decisions:j,queuedMessages:w,isStreaming:g.some(e=>"running"===e.status||"waiting_input"===e.status),libraryItems:function(e){let t=[];for(let a of e)if(a.reasoning?.evidence?.length)for(let e of a.reasoning.evidence)t.push({id:`${a.id}-${e.id}`,collection:"web",title:e.label,summary:`Referenced in assistant message ${a.id.slice(0,8)}`,freshness:O(a.createdAt),tags:["evidence","chat"],evidenceLabel:e.label,...e.href?{evidenceHref:e.href}:{}});return t.slice(0,60)}(h),preferences:C,setActiveThreadId:R,setActiveBranchId:B,createThread:_,createBranch:H,pinBranch:Q,sendMessage:z,interruptRun:q,reorderQueue:P,removeQueued:U,resolveDecision:$,setPreference:V,refreshNow:G}}(e),Y=(0,a.useMemo)(()=>N.slice(0,8),[N]),J=j.some(e=>"waiting_input"===e.status),Z=e=>{u(null),e.catch(e=>{u(String(e?.message||"Action failed"))})},ee=e=>{let t=window.prompt("Branch name",`What-if ${new Date().toLocaleTimeString()}`);t&&Z(G(t,e))};return p?(0,t.jsx)("section",{className:"bat-surface p-6",children:(0,t.jsx)("p",{className:"text-sm",style:{color:"var(--bat-text-muted)"},children:"Initializing workspace runtime..."})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-3 space-y-3",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.13em]",style:{color:"var(--bat-text-muted)"},children:"Workspace"}),(0,t.jsx)("h1",{className:"text-xl font-semibold",children:e})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:"rounded-full border px-3 py-1.5 text-sm",style:{borderColor:"var(--bat-border)"},onClick:()=>i(e=>!e),children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)(B,{className:"h-4 w-4"})," Library"]})}),(0,t.jsx)("button",{type:"button",className:"rounded-full border px-3 py-1.5 text-sm",style:{borderColor:"var(--bat-border)"},onClick:()=>l(e=>!e),children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[r?(0,t.jsx)(I,{className:"h-4 w-4"}):(0,t.jsx)(R,{className:"h-4 w-4"}),r?"Split Mode":"Focus Mode"]})}),(0,t.jsx)(X,{onSelect:e=>{if("Open library: Web"===e){i(!0),c("web");return}if("Open library: Competitors"===e){i(!0),c("competitors");return}"Switch workspace"===e?m.push("/app"):Z(q(e,C?"queue":"send"))}})]})]}),(0,t.jsxs)("div",{className:"bat-surface flex flex-wrap items-end gap-3 p-3",children:[(0,t.jsxs)("label",{className:"text-xs uppercase tracking-[0.08em]",style:{color:"var(--bat-text-muted)"},children:["Thread",(0,t.jsx)("select",{value:g||"",onChange:e=>T(e.target.value),className:"mt-1 block min-w-[220px] rounded-xl border px-3 py-2 text-sm",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)"},children:b.map(e=>(0,t.jsx)("option",{value:e.id,children:e.title},e.id))})]}),(0,t.jsxs)("label",{className:"text-xs uppercase tracking-[0.08em]",style:{color:"var(--bat-text-muted)"},children:["Branch",(0,t.jsx)("select",{value:y||"",onChange:e=>Z(z(e.target.value)),className:"mt-1 block min-w-[220px] rounded-xl border px-3 py-2 text-sm",style:{borderColor:"var(--bat-border)",background:"var(--bat-surface)"},children:f.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)("button",{type:"button",className:"rounded-full border px-3 py-2 text-sm",style:{borderColor:"var(--bat-border)"},onClick:()=>{let e=window.prompt("Thread name","Main workspace thread");e&&Z(W(e))},children:"New Thread"}),(0,t.jsx)("button",{type:"button",className:"rounded-full border px-3 py-2 text-sm",style:{borderColor:"var(--bat-border)"},onClick:()=>ee(),children:"Fork Branch"}),(0,t.jsx)("button",{type:"button",className:"rounded-full border px-3 py-2 text-sm",style:{borderColor:"var(--bat-border)"},onClick:()=>Z(K()),children:"Refresh"}),(0,t.jsx)("span",{className:"bat-chip",children:x?"Syncing...":C?"Running":"Idle"}),(0,t.jsxs)("span",{className:"bat-chip",children:["Queued: ",k.length]}),J?(0,t.jsx)("span",{className:"bat-chip",children:"Needs decision"}):null,A.askQuestionsFirst?(0,t.jsx)("span",{className:"bat-chip",children:"Question-first mode"}):null]}),h||d?(0,t.jsx)("div",{className:"rounded-2xl border p-3 text-sm",style:{borderColor:"#f4b8b4",background:"#fff5f4",color:"#9f2317"},children:(0,t.jsx)("p",{children:h||d})}):null]}),(0,t.jsxs)("div",{className:`grid gap-4 ${r?"grid-cols-1":"grid-cols-1 xl:grid-cols-[1fr,360px]"}`,children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(V,{messages:v,onForkFromMessage:ee}),(0,t.jsx)($,{isStreaming:C,queuedMessages:k,onSend:(e,t)=>{Z(q(e,t))},onStop:()=>Z(P()),onReorderQueue:(e,t)=>Z(U(e,t)),onDeleteQueued:e=>Z(_(e)),onSteer:e=>{let t=ed[e];if(t){if(t.pref){let[e,a]=t.pref;"tone"===e&&("balanced"===a||"concise"===a)&&Q("tone",a),"sourceFocus"===e&&("mixed"===a||"web"===a||"social"===a)&&Q("sourceFocus",a),"transparency"===e&&"boolean"==typeof a&&Q("transparency",a),"askQuestionsFirst"===e&&"boolean"==typeof a&&Q("askQuestionsFirst",a)}t.prompt&&Z(q(t.prompt,C?"queue":"send"))}}}),r?(0,t.jsxs)("section",{className:"bat-surface flex items-center justify-between gap-2 p-3 text-sm",children:[(0,t.jsxs)("p",{children:["Live activity in compact mode. ",(0,t.jsx)("strong",{children:j.filter(e=>"running"===e.status).length})," ","active process(es)."]}),(0,t.jsx)("span",{className:"bat-chip",children:x?"syncing":"ready"})]}):null]}),r?null:(0,t.jsx)(ei,{runs:j,feedItems:Y,decisions:w,onResolve:(e,t)=>Z(H(e,t))})]}),(0,t.jsx)(ec,{open:n,onClose:()=>i(!1),items:S,activeCollection:o,onCollectionChange:c,onUseInChat:e=>{var t;return t=e.title,void(Z(q(`Use evidence from: ${t}`,C?"queue":"send")),i(!1))}})]})}function em({workspaceId:e}){let[r,l]=(0,a.useState)(!0),[n,i]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),d=(0,a.useCallback)(async()=>{l(!0);try{let t=await (0,s.fetchWorkspaceIntakeStatus)(e);i(t),c(null)}catch(e){c(String(e?.message||"Failed to load workspace setup status"))}finally{l(!1)}},[e]);return((0,a.useEffect)(()=>{d()},[d]),r)?(0,t.jsx)("section",{className:"bat-surface p-6",children:(0,t.jsx)("p",{className:"text-sm",style:{color:"var(--bat-text-muted)"},children:"Checking workspace setup..."})}):o?(0,t.jsxs)("section",{className:"bat-surface space-y-3 p-6",children:[(0,t.jsx)("p",{className:"text-sm",style:{color:"#9f2317"},children:o}),(0,t.jsx)("button",{type:"button",onClick:()=>{d()},className:"rounded-full border px-4 py-2 text-sm",style:{borderColor:"var(--bat-border)"},children:"Retry"})]}):n?.completed?(0,t.jsx)(eu,{workspaceId:e}):(0,t.jsx)(T,{workspaceId:e,initialPrefill:n?.prefill,onCompleted:d})}e.s(["ChatOsLayout",()=>em],62729)}]);