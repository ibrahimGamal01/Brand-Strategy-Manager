# OpenAI API
OPENAI_API_KEY=OPENAI_API_KEY_FROM_SECRET_MANAGER
OPENAI_API_KEY_FALLBACK=OPENAI_API_KEY_FALLBACK_FROM_SECRET_MANAGER

# AI mode
AI_FALLBACK_MODE=off               # Use "mock" only in non-production local testing
MAX_TOKENS_PER_CALL=4000            # Maximum tokens per API call
MONTHLY_AI_BUDGET=200.00            # Monthly budget in USD ($200 = ~100 businesses)
COST_ALERT_THRESHOLD=150.00         # Alert when costs exceed this ($150 = 75% of budget)

# Optional AI model overrides
OPENAI_COMPETITOR_MODEL=gpt-5-mini
OPENAI_COMPETITOR_PLANNER_MODEL=gpt-5-mini
STRATEGY_DOC_CHAT_MODEL=gpt-5-mini
WORKSPACE_CHAT_MODEL=gpt-5-mini
# Central model router (A track) - keep OpenAI-specific vars above for backwards compatibility.
AI_PROVIDER_DEFAULT=openai
AI_MODEL_DEFAULT_FAST=gpt-5-mini
AI_MODEL_DEFAULT_QUALITY=gpt-5.2
AI_MODEL_WORKSPACE_CHAT=gpt-5-mini
AI_MODEL_WORKSPACE_CHAT_PLANNER=gpt-5-mini
AI_MODEL_WORKSPACE_CHAT_WRITER=gpt-5.2
AI_MODEL_WORKSPACE_CHAT_VALIDATOR=gpt-5-mini
AI_MODEL_STRATEGY_DOC_CHAT=gpt-5-mini
AI_MODEL_COMPETITOR_DISCOVERY=gpt-5-mini
AI_MODEL_COMPETITOR_PLANNER=gpt-5-mini
AI_MODEL_CONTENT_GENERATION=gpt-5.2
AI_MODEL_ANALYSIS_QUALITY=gpt-5.2
AI_MODEL_ANALYSIS_FAST=gpt-5-mini
AI_MODEL_VALIDATION_FAST=gpt-5-mini
AI_MODEL_VISION_OCR=gpt-5-mini
AI_MODEL_MEDIA_ANALYSIS=gpt-5.2
AI_MODEL_INTAKE_COMPLETION=gpt-5-mini
AI_MODEL_BRAIN_COMMAND=gpt-5-mini
AI_ALLOW_LEGACY_CHAT_MODEL_FALLBACK=false
AI_ENABLE_LEGACY_MODEL_REMAPPING=false
# Optional fallback chain per task:
# AI_MODEL_WORKSPACE_CHAT_WRITER_FALLBACKS=gpt-5-mini
# AI_MODEL_DEFAULT_QUALITY_FALLBACKS=gpt-5-mini
# AI_MODEL_DEFAULT_FAST_FALLBACKS=gpt-4o-mini
# Optional alternate provider credentials
# OPENROUTER_API_KEY=
# OPENROUTER_API_KEY_FALLBACK=
# OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
# OPENROUTER_HTTP_REFERER=
# OPENROUTER_APP_NAME=BrandStrategyManager
# Optional runtime pricing map for cost tracker:
# AI_MODEL_PRICING_JSON={\"gpt-5.2\":{\"input\":0.005,\"output\":0.015},\"gpt-5-mini\":{\"input\":0.00015,\"output\":0.0006}}
RAG_ALLOW_DEGRADED_CONTEXT=false
TIKTOK_SUGGESTION_CONFIDENCE_THRESHOLD=0.7

# Node Environment
NODE_ENV=development
# PORT is used in production (e.g., Railway). BACKEND_PORT remains supported for local/dev.
PORT=3001
BACKEND_PORT=3001

# Database
DATABASE_URL=postgresql://user:password@localhost:5433/dbname

# Storage (optional override, defaults to apps/backend/storage)
STORAGE_ROOT=/app/apps/backend/storage

# Apify (Instagram scraping + media URL resolving)
APIFY_API_TOKEN=APIFY_API_TOKEN_FROM_SECRET_MANAGER
APIFY_ACTOR_ID=apify~instagram-api-scraper
APIFY_MEDIA_DOWNLOADER_TOKEN=APIFY_MEDIA_DOWNLOADER_TOKEN_FROM_SECRET_MANAGER
APIFY_MEDIA_DOWNLOADER_ACTOR_ID=igview-owner~instagram-video-downloader

# Scrapling worker (optional; backend falls back to lightweight HTTP mode when missing)
SCRAPLING_WORKER_URL=
SCRAPLING_TIMEOUT_MS=20000

# Brain + recovery toggles
BRAIN_COMMAND_REPLY_ENABLED=false
DEBUG_BRAIN_SYNC=false
RECOVERY_ENABLED=false

# Brand intelligence orchestration
BRAND_INTEL_STALE_MINUTES=10

# Orchestration (continuous orchestrator runs every N minutes)
ORCHESTRATION_ENABLED=true
ORCHESTRATION_INTERVAL_MINUTES=15
ORCHESTRATION_STATUSES=COMPLETE,ANALYZING,SCRAPING_CLIENT,SCRAPING_COMPETITORS,DISCOVERING_COMPETITORS
# Minimum hours between orchestrator-triggered client scrapes (Apify/Instagram, TikTok) per job. Reduces cost from repeated gap-triggered runs.
ORCHESTRATOR_CLIENT_SCRAPE_THROTTLE_HOURS=6

# Competitor orchestration tuning (optional)
COMPETITOR_ORCHESTRATION_STALE_MINUTES=10
COMPETITOR_ORCHESTRATE_SYNC_TIMEOUT_MS=15000
COMPETITOR_COLLECTOR_MAX_MS=180000
COMPETITOR_SCRAPE_CHUNK_SIZE=3
COMPETITOR_SCRAPE_CHUNK_DELAY_MS=1000
COMPETITOR_VALIDATION_TIMEOUT_MS=15000
COMPETITOR_VERIFICATION_TIMEOUT_MS=10000
COMPETITOR_VALIDATION_CONCURRENCY=6
COMPETITOR_VALIDATION_MAX_PER_PLATFORM=8
COMPETITOR_PREVALIDATION_CAP_PER_PLATFORM=20
COMPETITOR_CONTINUE_QUEUE_MAX=25
COMPETITOR_QUEUE_CLIENT_RESERVE=3
COMPETITOR_FILTERED_MIN_SCORE=45
COMPETITOR_MAX_FILTERED_PER_RUN=15
COMPETITOR_MIN_REVIEW_TARGET=5
COMPETITOR_TOP_PICK_SCORE=78
COMPETITOR_SHORTLIST_SCORE=65
COMPETITOR_PROMOTION_SCORE=55
RESEARCH_COMPETITOR_FILTERED_CAP=20

# Continuity loop (auto-continue scraping)
RESEARCH_CONTINUITY_POLL_MS=60000

# Research event persistence + retention
RESEARCH_EVENTS_RETENTION_DAYS=30
RESEARCH_EVENTS_MAX_PER_JOB=5000
RESEARCH_EVENTS_PRUNE_INTERVAL_MS=21600000

# Social scraping limits (Instagram defaults to 50; TikTok uses SOCIAL_SCRAPE_POST_LIMIT)
INSTAGRAM_POST_LIMIT=50
SOCIAL_SCRAPE_POST_LIMIT=4
# Optional Instagram session cookies (for GraphQL/HTML scraping)
INSTAGRAM_SESSION_COOKIE=
INSTAGRAM_SESSION_COOKIES=

# Social media download controls (keeps continue cycles responsive)
SOCIAL_MEDIA_DOWNLOAD_POST_LIMIT=8
SOCIAL_MEDIA_MAX_FAILURES=3
SOCIAL_MEDIA_FAILURE_COOLDOWN_MS=43200000
# Set true to download TikTok video/photo page URLs via Camoufox (tiktok.com/.../video/... or .../photo/...)
ENABLE_TIKTOK_PAGE_DOWNLOAD=false

# Media analysis + transcription (optional)
MEDIA_ANALYZER_MAX_AUDIO_SEC=600
LOCAL_TRANSCRIPTION_SCRIPT=

# Downloader + scraper proxy/IP rotation (comma-separated URLs)
SCRAPER_PROXY_URLS=
INSTAGRAM_SCRAPER_PROXY_URLS=
TIKTOK_SCRAPER_PROXY_URLS=
TIKTOK_DOWNLOADER_PROXY_URLS=
YOUTUBE_SCRAPER_PROXY_URLS=
INSTAGRAM_MEDIA_RESOLVER_PROXY_URLS=
MEDIA_DOWNLOADER_PROXY_URLS=
# Optional single-proxy override (used by ad-hoc scripts)
SCRAPER_PROXY_URL=
PROXY_URL=
PROXY_URLS=
MEDIA_PROXY_URLS=
# Standard proxy env (optional)
HTTP_PROXY=
HTTPS_PROXY=
MEDIA_PROXY_ALLOW_DIRECT=true
SCRAPER_PROXY_ALLOW_DIRECT=true
MEDIA_PROXY_MAX_FAILURES=2
MEDIA_PROXY_COOLDOWN_MS=120000
SCRAPER_PROXY_MAX_FAILURES=2
SCRAPER_PROXY_COOLDOWN_MS=120000
MEDIA_DOWNLOAD_MAX_ATTEMPTS=3
MEDIA_DOWNLOAD_TIMEOUT_MS=60000
SCRAPER_COMMAND_MAX_ATTEMPTS=3
INSTAGRAM_MEDIA_RESOLVE_ATTEMPTS=2
INSTAGRAM_CAMOUFOX_SCRAPE_ATTEMPTS=2
INSTAGRAM_PYTHON_SCRAPE_ATTEMPTS=2
TIKTOK_CAMOUFOX_SCRAPE_ATTEMPTS=2
TIKTOK_YTDLP_SCRAPE_ATTEMPTS=3
TIKTOK_CAMOUFOX_DOWNLOAD_ATTEMPTS=2
TIKTOK_PUPPETEER_DOWNLOAD_ATTEMPTS=2
YOUTUBE_INFO_ATTEMPTS=2
YOUTUBE_DOWNLOAD_ATTEMPTS=3

# Script/utility helpers (optional)
BACKFILL_FORCE=0
BASELINE_HASH_SALT=local-baseline-salt

# Expected Costs Per Business:
# - 12 AI Questions: ~$1.12 (one-time per research job)
# - Document Generation: ~$0.48 (per strategy document)
# - Total: ~$1.60 per complete brand strategy
# 
# Budget of $200/month supports approximately:
# - 100 businesses with 25% safety margin
# - Or 125 businesses at full capacity
